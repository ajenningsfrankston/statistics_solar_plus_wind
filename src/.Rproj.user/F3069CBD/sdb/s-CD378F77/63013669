{
    "collab_server" : "",
    "contents" : "#\n# progress of energy balance over the day \n# \n#\nlibrary(ggplot2)\n\n\nsource(\"trim_storage.R\")\nsource(\"convolution.R\")\nsource(\"mean.R\")\nsource(\"sum_probs.R\")\n\nstorage_capacity = 1.0\n\nhrs = seq(7,22)\n\ndemand = vector(mode=\"numeric\",length=24)\n\ndemand[] = 1.0\ndemand[6:9] = 1.5\ndemand[16:20] = 2.0\n\n# residual (eg. 4am) demand\n\nbackground_demand = 0.50\n\ndemand <- background_demand*demand\n\n# for non demand hours wind feeds to storage\n\nbhrs = seq(1,7)\n\nload(file=\"../rdata/wind_density.rd\")\n\nstorage_density <- wind_density\n\n\nfor (hr in bhrs) {\n  \n  d <- convolution(wind_density,storage_density)\n  \n  storage_density$x = d$z\n  storage_density$y = d$dz\n  \n  storage_density$x <- storage_density$x - background_demand\n  \n  \n#  plot(storage_density)\n  \n  storage_density <- trim_storage(storage_density,storage_capacity)\n  storage_density <- normd(storage_density)\n  \n#  plot(storage_density)\n  \n  \n}\n\nmean_storage <- mean(storage_density)\n\n\n# demand hours 7 to 22: balance between supply, demand and storage \n\nbalance_densities = list() \n\nload(file=\"../rdata/list_sum_densities.rd\")\n\npeak_density <- sum_densities[[12]]\n\nmean_peak <- mean(peak_density)\n\nstorage_trace = data.frame(hrs)\nstorage_trace[\"balance\"] <- NA\nstorage_trace[\"withdraw\"] <- NA\n\nfor (hr in hrs) {\n  \n       balance = sum_densities[[hr]]\n  \n       balance$x <- balance$x - demand[hr]\n       \n       surplus <- mean(balance)\n       mean_storage <- mean_storage + surplus\n       if (mean_storage > storage_capacity) { mean_storage <- storage_capacity}\n    \n       threshold_loc <- min(which(balance$y>0.01))\n       threshold <- balance[threshold_loc,]$x\n       \n       if ((threshold < 0) && (mean_storage > 0)) {\n         withdraw <- -threshold\n         if (withdraw > mean_storage) { withdraw <- mean_storage }\n         \n         balance$x <- balance$x + withdraw \n         mean_storage <- mean_storage - withdraw\n         \n         storage_trace$balance[hr-hrs[1]+1] <- mean_storage\n         storage_trace$withdraw[hr-hrs[1]+1] <- withdraw\n        \n       }\n       \n       title = paste(\"Time \",hr,\":00\",\" Balance\",\"  Peak Supply/Base Demand \",format(mean_peak/background_demand,digits=2)) \n       title <- paste(title,\" Storage \",storage_capacity,sep=\"\")\n       \n       p <- ggplot(balance,aes(x=x,y=y)) + geom_line() + ggtitle(title)\n       p <- p +labs(y=\"p(x)\")\n       print(p)\n       Sys.sleep(2)\n     \n  \n}\n\np <- ggplot(storage_trace,aes(x=hrs,y=balance)) + geom_line()\nprint(p)\nSys.sleep(2)\np <- ggplot(storage_trace,aes(x=hrs,y=withdraw)) + geom_line()\nprint(p)\n\n\n",
    "created" : 1480755857955.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "988102328",
    "id" : "63013669",
    "lastKnownWriteTime" : 1482206752,
    "last_content_update" : 1482206752158,
    "path" : "~/statistics_solar_plus_wind/src/day_trace.R",
    "project_path" : "day_trace.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}